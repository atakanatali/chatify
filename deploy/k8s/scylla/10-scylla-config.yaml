apiVersion: v1
kind: ConfigMap
metadata:
  name: chatify-scylla-config
  namespace: chatify
  labels:
    app.kubernetes.io/name: chatify-scylla
    app.kubernetes.io/component: database
    app.kubernetes.io/part-of: chatify
    app.kubernetes.io/managed-by: kubectl
data:
  # ScyllaDB configuration optimized for kind/local development
  scylla.yaml: |
    # Developer mode: runs on systems with fewer cores
    developer-mode: true
    consistent_cluster_management: false

    # Data directory
    developer-mode-with-lwt: true

    # Networking configuration
    listen_address: 0.0.0.0
    rpc_address: 0.0.0.0
    broadcast_address: $(POD_IP)
    broadcast_rpc_address: $(POD_IP)

    # Seed configuration (single node for development)
    seed_node_provider: none
    seeds: ""

    # Workload optimization
    workloads:
      - name: chatify
        class: streaming

    # Memory configuration for kind environment
    memory:
      # 400MB for kind/local development where resources are constrained
      total_memory: 419430400

    # CPU configuration
    cpu:
      # Allow ScyllaDB to detect available CPUs
      force_setaffinity: false

    # Disk I/O configuration
    disk_io_mode: default

    # Server configuration
    api:
      address: 0.0.0.0
      port: 10000

    # Alternator (DynamoDB API) - disabled
    alternator:
      enabled: false
      write_isolation: only_rm

    # SSTable configuration
    sstable:
      max_size: 100

    # Commit log configuration
    commitlog:
      sync: periodic
      segment_size_in_mb: 32

    # CDC configuration
    cdc:
      enabled: false

    # SSL/TLS - disabled for local development
    ssl:
      enabled: false
      certificate: ""
      keyfile: ""

    # Client encryption - disabled for local development
    client_encryption:
      enabled: false

    # Authentication - disabled for local development
    authenticator: AllowAllAuthenticator

    # Authorization
    authorizer: AllowAllAuthorizer

    # Batch size optimization
    batch_size:
      threshold: 10
      fail_threshold: 50

    # Range request optimization
    range_requests:
      range_size: 64

    # Tombstone warning threshold
    tombstone_warning_threshold: 10000

    # Hinted handoff
    hinted_handoff:
      enabled: true

    # Read repair
    read_repair:
      chance: 0.1

    # Repair configuration
    repair:
      stream_throughput_mb_per_sec: 100
      repair_parallelism: parallel

    # Logging
    logger:
      default_log_level: info
      syslog_log_level: warning

    # Tracing
    tracing:
      type: noop
      trace_slow_queries: true
      slow_query_threshold_in_ms: 500
